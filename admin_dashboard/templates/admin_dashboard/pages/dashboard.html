{% extends "core/_base.html" %}
{% load static %}

{% block content %}

<!--begin::App Content Header-->
<div class="app-content-header">
    <!--begin::Container-->
    <div class="container-fluid">
      <!--begin::Row-->
      <div class="row">
        <div class="col-sm-6"><h3 class="mb-0">Dashboard</h3></div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-end">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
          </ol>
        </div>
      </div>
      <!--end::Row-->
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content Header-->
  <!--begin::App Content-->
  <div class="app-content">
    <!--begin::Container-->
    <div class="container-fluid">
      <!--begin::Row-->
      <div class="row">
        <!--begin::Col-->
        <div class="col-lg-3 col-6">
          <!--begin::Small Box Widget 1-->
          <div class="small-box text-bg-primary">
            <div class="inner">
              <h3>150</h3>
              <p>New Orders</p>
            </div>
            <svg
              class="small-box-icon"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <path
                d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
              ></path>
            </svg>
            <a
              href="#"
              class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
            >
              More info <i class="bi bi-link-45deg"></i>
            </a>
          </div>
          <!--end::Small Box Widget 1-->
        </div>
        <!--end::Col-->
        <div class="col-lg-3 col-6">
          <!--begin::Small Box Widget 2-->
          <div class="small-box text-bg-success">
            <div class="inner">
              <h3>53<sup class="fs-5">%</sup></h3>
              <p>Bounce Rate</p>
            </div>
            <svg
              class="small-box-icon"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <path
                d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
              ></path>
            </svg>
            <a
              href="#"
              class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
            >
              More info <i class="bi bi-link-45deg"></i>
            </a>
          </div>
          <!--end::Small Box Widget 2-->
        </div>
        <!--end::Col-->
        <div class="col-lg-3 col-6">
          <!--begin::Small Box Widget 3-->
          <div class="small-box text-bg-warning">
            <div class="inner">
              <h3>44</h3>
              <p>User Registrations</p>
            </div>
            <svg
              class="small-box-icon"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <path
                d="M6.25 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM3.25 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM19.75 7.5a.75.75 0 00-1.5 0v2.25H16a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H22a.75.75 0 000-1.5h-2.25V7.5z"
              ></path>
            </svg>
            <a
              href="#"
              class="small-box-footer link-dark link-underline-opacity-0 link-underline-opacity-50-hover"
            >
              More info <i class="bi bi-link-45deg"></i>
            </a>
          </div>
          <!--end::Small Box Widget 3-->
        </div>
        <!--end::Col-->
        <div class="col-lg-3 col-6">
          <!--begin::Small Box Widget 4-->
          <div class="small-box text-bg-danger">
            <div class="inner">
              <h3>65</h3>
              <p>Unique Visitors</p>
            </div>
            <svg
              class="small-box-icon"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <path
                clip-rule="evenodd"
                fill-rule="evenodd"
                d="M2.25 13.5a8.25 8.25 0 018.25-8.25.75.75 0 01.75.75v6.75H18a.75.75 0 01.75.75 8.25 8.25 0 01-16.5 0z"
              ></path>
              <path
                clip-rule="evenodd"
                fill-rule="evenodd"
                d="M12.75 3a.75.75 0 01.75-.75 8.25 8.25 0 018.25 8.25.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75V3z"
              ></path>
            </svg>
            <a
              href="#"
              class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
            >
              More info <i class="bi bi-link-45deg"></i>
            </a>
          </div>
          <!--end::Small Box Widget 4-->
        </div>
        <!--end::Col-->
      </div>
      <!--end::Row-->
      <!--begin::Row-->
      <div class="row">
        <!-- Start col User Summary-->
        <div class="col-xl-4 col-lg-6 col-12 connectedSortable">
          <div class="card mb-4">
            <div class="card-header"><h3 class="card-title">User Summary</h3></div>
            <div class="card-body">
              {% comment %} <div id="revenue-chart">re</div> {% endcomment %}
              <canvas id="userSummaryPieChart"></canvas>
            </div>
          </div>
          <!-- /.card -->
          
        </div>
        <!-- /.End col .User Summary-->
        <!-- Start col Buyer & Supplier Summary -->
        <div class="col-xl-4 col-lg-6 col-12 connectedSortable">
          <div class="card mb-4">
            <div class="card-header border-0">
              <h3 class="card-title">Buyer & Supplier Summary </h3>
            </div>
            <div class="card-body">
              <canvas id="doughnutChart"></canvas>
            </div>
            
          </div>
        </div>
        <!-- /.End col Buyer & Supplier Summary -->
        <!-- Start col Fabric Overview -->
        <div class="col-xl-4 col-lg-6 col-12 connectedSortable">
          <div class="card mb-4">
            <div class="card-header border-0">
              <h3 class="card-title">Fabric Overview </h3>
            </div>
            <div class="card-body">
              <canvas id="barChartFabric"></canvas>
            </div>
         
          </div>
        </div>
        <!-- /.end col Fabric Overview -->
      </div>
      <!-- /.row (main row) -->
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content-->
{% endblock content %}


{% block push_scripts %}
{% comment %} <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js" integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> {% endcomment %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
  // Minimal Utils for Chart.js demo purposes
  const Utils = {
    numbers: function({count, min, max}) {
      const arr = [];
      for (let i = 0; i < count; i++) {
        arr.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      return arr;
    },
    months: function({count}) {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July',
                          'August', 'September', 'October', 'November', 'December'];
      // Repeat months if count > 12
      let arr = [];
      for (let i = 0; i < count; i++) {
        arr.push(monthNames[i % 12]);
      }
      return arr;
    },
    rand: function(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    namedColor: function(index) {
      const colors = ['red', 'blue', 'green', 'orange', 'purple', 'cyan', 'magenta', 'yellow'];
      return colors[index % colors.length];
    },
    transparentize: function(color, opacity) {
      // Simple fallback for demo: just return the color
      return color;
    },
    CHART_COLORS: {
      red: 'rgb(255, 99, 132)',
      blue: 'rgb(54, 162, 235)',
      green: 'rgb(75, 192, 192)',
      orange: 'rgb(255, 159, 64)',
      purple: 'rgb(153, 102, 255)'
    }
  };
</script>

<script>
  $(document).ready(function () {
    // Pie chart user summary 
    $(function(){
      // Fetch user summary data from backend using AJAX
      let data = {
        labels: [],
        datasets: [{
          label: 'User Summary',
          data: [],
          backgroundColor: [],
          hoverOffset: 4
        }]
      };

      $.ajax({
        url: "{% url 'admin_dashboard:user-summary-data' %}", // Replace with your actual URL name
        method: "GET",
        dataType: "json",
        success: function(response) {
          console.log(response)
          data.labels = response.labels;
          data.datasets[0].data = response.data;
          data.datasets[0].backgroundColor = response.background_color;
          // Optionally update backgroundColor if dynamic
        },
        error: function(xhr, status, error) {
          console.error("Failed to fetch user summary data:", error);
        },
        async: false // Ensures data is loaded before chart is rendered
      });
  
      const config = {
        type: 'pie',
        data: data,
      };
  
      const userSummaryPieChart = new Chart(
        $('#userSummaryPieChart')[0], // jQuery object converted to DOM element
        config
      );
    })

    // Doughnut chart for Buyer and supplier summary 
    $(function(){
      // <block:setup:1>
      const data = {
        labels: [
          'Red',
          'Blue',
          'Yellow'
        ],
        datasets: [{
          label: 'My First Dataset',
          data: [300, 50, 100],
          backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 205, 86)'
          ],
          hoverOffset: 4
        }]
      };
      // </block:setup>

      // <block:config:0>
      const config = {
        type: 'doughnut',
        data: data,
      };

      const doughnutChart = new Chart(
        $('#doughnutChart')[0], // jQuery object converted to DOM element
        config
      );
    })

    // bar chart for fabric info 
    $(function(){
      // <block:actions:2>
      const actions = [
        {
          name: 'Randomize',
          handler(chart) {
            chart.data.datasets.forEach(dataset => {
              dataset.data = Utils.numbers({count: chart.data.labels.length, min: -100, max: 100});
            });
            chart.update();
          }
        },
        {
          name: 'Add Dataset',
          handler(chart) {
            const data = chart.data;
            const dsColor = Utils.namedColor(chart.data.datasets.length);
            const newDataset = {
              label: 'Dataset ' + (data.datasets.length + 1),
              backgroundColor: Utils.transparentize(dsColor, 0.5),
              borderColor: dsColor,
              borderWidth: 1,
              data: Utils.numbers({count: data.labels.length, min: -100, max: 100}),
            };
            chart.data.datasets.push(newDataset);
            chart.update();
          }
        },
        {
          name: 'Add Data',
          handler(chart) {
            const data = chart.data;
            if (data.datasets.length > 0) {
              data.labels = Utils.months({count: data.labels.length + 1});

              for (let index = 0; index < data.datasets.length; ++index) {
                data.datasets[index].data.push(Utils.rand(-100, 100));
              }

              chart.update();
            }
          }
        },
        {
          name: 'Remove Dataset',
          handler(chart) {
            chart.data.datasets.pop();
            chart.update();
          }
        },
        {
          name: 'Remove Data',
          handler(chart) {
            chart.data.labels.splice(-1, 1); // remove the label first

            chart.data.datasets.forEach(dataset => {
              dataset.data.pop();
            });

            chart.update();
          }
        }
      ];
      // </block:actions>

      // <block:setup:1>
      const DATA_COUNT = 7;
      const NUMBER_CFG = {count: DATA_COUNT, min: -100, max: 100};

      const labels = Utils.months({count: 7});
      const data = {
        labels: labels,
        datasets: [
          {
            label: 'Dataset 1',
            data: Utils.numbers(NUMBER_CFG),
            borderColor: Utils.CHART_COLORS.red,
            backgroundColor: Utils.transparentize(Utils.CHART_COLORS.red, 0.5),
          },
          {
            label: 'Dataset 2',
            data: Utils.numbers(NUMBER_CFG),
            borderColor: Utils.CHART_COLORS.blue,
            backgroundColor: Utils.transparentize(Utils.CHART_COLORS.blue, 0.5),
          }
        ]
      };
      // </block:setup>

      // <block:config:0>
      const config = {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Chart.js Bar Chart'
            }
          }
        },
      };
      // </block:config>
      const barChartFabric = new Chart(
        $('#barChartFabric')[0], // jQuery object converted to DOM element
        config
      );
    })
  });
</script>
{% endblock push_scripts %}